<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="favicon.ico" >
<link rel="Shortcut Icon" href="favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<style>
	.over {position: fixed; left:0; top:0; width:100%; z-index:100;}
	.tempContainer {position:fixed; width:100%; margin-right:0px; margin-left:0px; text-align:center; z-index:101;}
	.amplifyImg {float: left}
</style>
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script type="text/javascript" src="lib/jquery/jquery-3.5.1.min.js"></script>
<script>DD_belatedPNG.fix('*');</script><![endif]-->
<!--/meta 作为公共模版分离出去-->

<title>用户收货地址列表</title>
</head>
<body>
<!--_header 作为公共模版分离出去-->
<header class="navbar-wrapper">
	<div class="navbar navbar-fixed-top">
		<div class="container-fluid cl"> <a class="logo navbar-logo f-l mr-10 hidden-xs" href="index.html">多来美管理后台</a> <a class="logo navbar-logo-m f-l mr-10 visible-xs" href="#"></a>
			<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
				<ul class="cl">
					<li>超级管理员</li>
					<li class="dropDown dropDown_hover"> <a href="#" class="dropDown_A"> <i class="Hui-iconfont">&#xe6d5;</i></a>
						<ul class="dropDown-menu menu radius box-shadow">
							<li><a href="login.html">切换账户</a></li>
							<li><a href="login.html">退出</a></li>
						</ul>
					</li>
					<li id="Hui-skin" class="dropDown right dropDown_hover"> <a href="javascript:;" class="dropDown_A" title="换肤"><i class="Hui-iconfont" style="font-size:18px">&#xe62a;</i></a>
						<ul class="dropDown-menu menu radius box-shadow">
							<li><a href="javascript:;" data-val="default" title="默认（黑色）">默认（黑色）</a></li>
							<li><a href="javascript:;" data-val="blue" title="蓝色">蓝色</a></li>
							<li><a href="javascript:;" data-val="green" title="绿色">绿色</a></li>
							<li><a href="javascript:;" data-val="red" title="红色">红色</a></li>
							<li><a href="javascript:;" data-val="yellow" title="黄色">黄色</a></li>
							<li><a href="javascript:;" data-val="orange" title="橙色">橙色</a></li>
						</ul>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</header>
<!--/_header 作为公共模版分离出去-->

<!--_menu 作为公共模版分离出去-->
<aside class="Hui-aside">

	<div class="menu_dropdown bk_2">
		<dl id="menu-picture">
			<dt><i class="Hui-iconfont">&#xe620;</i> <a href="goods-list.html" title="货物管理"> 货物管理</a></dt>
		</dl>
		<dl id="订单管理">
			<dt><i class="Hui-iconfont">&#xe687;</i> <a href="order-list.html" title="订单管理"> 订单管理</a></dt>
		</dl>
<!--		<dl id="menu-map">-->
<!--			<dt><i class="Hui-iconfont">&#xe625;</i><a href="shop-list.html" title="门店管理"> 门店管理</a></dt>-->
<!--		</dl>-->
		<dl id="menu-product">
			<dt><i class="Hui-iconfont">&#xe681;</i> <a href="	product-category.html" title="分类管理"> 分类管理</a></dt>
		</dl>
        <dl id="menu-picPlay">
            <dt><i class="Hui-iconfont">&#xe68d;</i> <a href="picPlay-list.html" title="轮播图管理"> 轮播图管理</a></dt>
        </dl>
		<dl id="menu-customer-shop">
			<dt><i class="Hui-iconfont">&#xe68d;</i> <a href="customer-shop-list.html" title="门店信息审核"> 门店信息审核</a></dt>
		</dl>
	</div>
</aside>
<div class="dislpayArrow hidden-xs"><a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a></div>
<!--/_menu 作为公共模版分离出去-->

<section class="Hui-article-box">
	<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 门店信息审核 <span class="c-gray en">&gt;</span> 门店信息列表 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a> </nav> <!--<a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a>-->
	<div class="Hui-article">
		<article class="cl pd-20">
			<div class="text-c"> 搜索条件：
<!--				<input type="text" onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'logmax\')||\'%y-%M-%d\'}'})" id="logmin" class="input-text Wdate" style="width:120px;">-->
<!--				- -->
<!--				<input type="text" onfocus="WdatePicker({minDate:'#F{$dp.$D(\'logmin\')}',maxDate:'%y-%M-%d'})" id="logmax" class="input-text Wdate" style="width:120px;">-->
				<!--
				class="select-box"
				class="select"
				-->
				<span id="statusOption" style="margin-right: 10px">
					<select name="" >
						<option value="-1" selected>全部</option>
						<option value="0">审核中</option>
						<option value="1">通过</option>
						<option value="2">不通过</option>
					</select>
				</span>
				<input type="text" name="" id="customerName" placeholder=" 用户名" style="width:100px" class="input-text">
				<input type="text" name="" id="shopName" placeholder="门店名" style="width:100px" class="input-text">
<!--				<input type="text" name="" id="goodsName" placeholder="商品名称" style="width:100px" class="input-text">-->
				<button name="" id="shopQuery" class="btn btn-success" type="submit"><i class="Hui-iconfont">&#xe665;</i> 搜门店</button>
<!--				<button name="" id="export" style="width: 60px;background-color: #00b7ee;border-color: #3bb4f2" class="btn btn-success" type="submit" onclick="exportExcel()">导出</button>-->
			</div>
			<div class="cl pd-5 bg-1 bk-gray mt-20">  <span class="r">共有数据：<strong id="totalNum"></strong> 条</span> </div>
			<div class="mt-20">
				<div id="DataTables_Table_0_wrapper" class="dataTables_wrapper no-footer">
				<!--mx-->
				<table class="table table-border table-bordered table-bg table-hover table-sort">
					<thead>
						<tr class="text-c">
							<th width="40">用户名</th>
							<th width="60">门店名称</th>
							<th width="40">联系号码</th>
							<th width="40">工商号</th>
							<th width="100">审核资料照片</th>
							<th width="100">收货地址</th>
							<th width="40">审批状态</th>
							<th width="30">操作</th>
						</tr>
					</thead>
					<tbody id="goodTableBody">
					</tbody>
				</table>
					<div class="dataTables_length" id="DataTables_Table_0_length" style="margin-top: 15px"><label style="margin-top: 10px" id="pageSizeShow">显示 <select name="DataTables_Table_0_length" aria-controls="DataTables_Table_0" class="" onchange="search()"><option value="30">30</option><option value="100">100</option><option value="200">200</option></select> 条</label></div>
					<div class="dataTables_paginate paging_simple_numbers" id="DataTables_Table_0_paginate"><a class="paginate_button previous disabled" aria-controls="DataTables_Table_0" data-dt-idx="0" tabindex="0" id="previous">上一页</a><span></span><a class="paginate_button next disabled" aria-controls="DataTables_Table_0" data-dt-idx="1" tabindex="0" id="next">下一页</a></div></div>
			<input hidden/>
			</div>
		</article>
	</div>
</section>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.page.js"></script>
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="lib/datatables/1.10.15/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript" src="lib/jquery/common.js"></script>
<script type="text/javascript">
	var page = 1;
	var pages;
	var picIndex = 1;
$(function () {
	//获取所有货物
	var pageSize = $("#pageSizeShow").find("option:selected").val();
	$.ajax({
		url: apiHeader + '/shop/getShopPage',
		data: {pageSize: pageSize},
		async: false,
		success: function (text, status) {
				if (text.code == 0) {
					var mystr = "";//$("#goodTableBody");
					var dataArray = text.data.records;
					pages = text.data.pages;
					for (var i = 0; i < dataArray.length; i++) {
						mystr = mystr + "<tr class='text-c'>";
						mystr = mystr + "<td>"+dataArray[i].customerName+"</td>";
						mystr = mystr + "<td>"+dataArray[i].shopName+"</td>";
						mystr = mystr + "<td>"+dataArray[i].shopPhone+"</td>";
						mystr = mystr + "<td>"+dataArray[i].businessNo+"</td>";
						//工商照片 分割字符串
						var picStr = dataArray[i].businessPic.split(',');
						var pic = "<td><div class=\"over\"></div>";

						/***
						 *
						 * <div class="over"></div><!--背景层-->
						 <div class="amplifyImg"><!--注意：此处的amlifyImg不可少-->
						 <img src="static/h-ui/images/dataTable/sort_asc.png"/><!-- 此处是引入图片的路径 -->
						 </div>
						 */
						for(var j = 0;j<picStr.length; j++){
							var divId = "amplifyImg" + picIndex;
							pic = pic + "<div onclick='PicOpen("+picIndex+")' id='" + divId + "' class=\"amplifyImg\"><img style='width: 85px;height: 45px;margin-left: 5px' src=\"" + apiHeader + picStr[j] + "\"/></div>";//<td><a href="javascript:;" onClick="picture_edit('图库编辑','picture-show.html','10001')"><img width="100" class="picture-thumb" src="pic/200x150.jpg"></a></td>
							picIndex = picIndex + 1;
						}
						pic = pic + "</td>";
						mystr = mystr + pic;
						mystr = mystr + "<td>"+dataArray[i].address+"</td>";
						if(dataArray[i].status == 0){
							mystr = mystr + "<td>待审核</td>";
						}else if(dataArray[i].status == 1){
							mystr = mystr + "<td>通过</td>";
						}else{
							mystr = mystr + "<td>不通过</td>";
						}

						//操作
						mystr = mystr + "<td><a onclick='auditShop("+ dataArray[i].id +",1)' style='color: green'>通过</a><a onclick='auditShop("+ dataArray[i].id +",2)' style='color: red;margin-left: 10px'>不通过</a></td>";
					}
					$("#goodTableBody").append(mystr);
					$("#totalNum").text(text.data.total);
				} else {
					window.location.href = "login.html";
				}
			}
	});


	//点击查询
	$("#shopQuery").click(function () {
    search()
	});

	//上一页
	$("#previous").click(function () {
		var name = $("#menuName").val();
		var startTime = $("#logmin").val();
		var endTime = $("#logmax").val();
		var pageSize = $("#pageSizeShow").find("option:selected").val();
		var goodsName = $("#goodsName").val();
		var phone = $("#phone").val();
		var customerName = $("#customerName").val();
		if(page > 1){
			page = page - 1;
		}
		queryGoodsList(name,startTime,endTime,page,pageSize,phone,goodsName,customerName);
	});

	//下一页
	$("#next").click(function () {
		var name = $("#menuName").val();
		var startTime = $("#logmin").val();
		var endTime = $("#logmax").val();
		var pageSize = $("#pageSizeShow").find("option:selected").val();
		var goodsName = $("#goodsName").val();
		var phone = $("#phone").val();
		var customerName = $("#customerName").val();
		if(page < pages){
			page = page + 1;
		}
		queryGoodsList(name,startTime,endTime,page,pageSize,phone,goodsName,customerName);
	});
});

//图片放大
function PicOpen(picIndex){
	var divId = "amplifyImg" + picIndex;
	var imgsObj = $('#' + divId + ' img');//需要放大的图像
	// if(imgsObj){
		// $.each(imgsObj,function(){
		// 	$(this).click(function(){
				var currImg = imgsObj;
				coverLayer(1);
				var tempContainer = $('<div class=tempContainer></div>');//图片容器
				with(tempContainer){//width方法等同于$(this)
					appendTo("body");
					var windowWidth=$(window).width();
					var windowHeight=$(window).height();
					//获取图片原始宽度、高度
					var orignImg = new Image();
					orignImg.src =currImg.attr("src") ;
					var currImgWidth= orignImg.width;
					var currImgHeight = orignImg.height;
					if(currImgWidth<windowWidth){//为了让图片不失真，当图片宽度较小的时候，保留原图
						if(currImgHeight<windowHeight){
							var topHeight=(windowHeight-currImgHeight)/2;
							if(topHeight>35){/*此处为了使图片高度上居中显示在整个手机屏幕中：因为在android,ios的微信中会有一个title导航，35为title导航的高度*/
								topHeight=topHeight-35;
								css('top',topHeight);
							}else{
								css('top',0);
							}
							html('<img border=0 src=' + currImg.attr('src') + '>');
						}else{
							css('top',0);
							html('<img border=0 src=' + currImg.attr('src') + ' height='+windowHeight+'>');
						}
					}else{
						var currImgChangeHeight=(currImgHeight*windowWidth)/currImgWidth;
						if(currImgChangeHeight<windowHeight){
							var topHeight=(windowHeight-currImgChangeHeight)/2;
							if(topHeight>35){
								topHeight=topHeight-35;
								css('top',topHeight);
							}else{
								css('top',0);
							}
							html('<img border=0 src=' + currImg.attr('src') + ' width='+windowWidth+';>');
						}else{
							css('top',0);
							html('<img border=0 src=' + currImg.attr('src') + ' width='+windowWidth+'; height='+windowHeight+'>');
						}
					}
				}
				tempContainer.click(function(){
					$(".tempContainer").remove();
					coverLayer(0);
				});
		// 	});
		// });
	// }
	// else{
	// 	return false;
	// }
}

//使用禁用蒙层效果
function coverLayer(tag){
	with($('.over')){
		if(tag==1){
			css('height',$(document).height());
			css('display','block');
			css('opacity',1);
			css("background-color","#FFFFFF");
			css("background-color","rgba(0,0,0,0.7)" );  //蒙层透明度
		}
		else{
			css('display','none');
		}
	}
}

function auditShop(id,status) {
	$.post(apiHeader + '/shop/saveShop',{id:id,status:status},function (res) {
		if(res.code == 0){
			//刷新当前页面
			window.location.reload();
		}else{
			layer.msg(res.message);
		}
	})
}

function search () {
  var pageSize = $("#pageSizeShow").find("option:selected").val();
  var shopName = $("#shopName").val();
  var customerName = $("#customerName").val();
  var statusOption = $("#status").find("option:selected").val();
  if(statusOption == "-1"){
  	//todo 
  	statusOption = null;
  }else{
	  statusOption = Number(statusOption);
  }


	page = 1;
  queryGoodsList(page,pageSize,shopName,customerName,statusOption);
}
//条件查询商品
function queryGoodsList(page,pageSize,shopName,customerName,status) {
	$.post(apiHeader + '/shop/getShopPage', {cpage: page,pageSize: pageSize,shopName: shopName,customerName: customerName,status:status},
			function (text, status) {
				console.log(text);

				if (text.code == 0) {
					$("#goodTableBody").html("");
					var mystr = "";//$("#goodTableBody");
					var dataArray = text.data.records;
					pages = text.data.pages;
					for (var i = 0; i < dataArray.length; i++) {
						mystr = mystr + "<tr class='text-c'>";
						mystr = mystr + "<td>"+dataArray[i].customerName+"</td>";
						mystr = mystr + "<td>"+dataArray[i].shopName+"</td>";
						mystr = mystr + "<td>"+dataArray[i].shopPhone+"</td>";
						mystr = mystr + "<td>"+dataArray[i].businessNo+"</td>";
						//工商照片 分割字符串
						var picStr = dataArray[i].businessPic.split(',');
						var pic = "<td><div class=\"over\"></div>";

						/***
						 *
						 * <div class="over"></div><!--背景层-->
						 <div class="amplifyImg"><!--注意：此处的amlifyImg不可少-->
						 <img src="static/h-ui/images/dataTable/sort_asc.png"/><!-- 此处是引入图片的路径 -->
						 </div>
						 */
						for(var j = 0;j<picStr.length; j++){
							var divId = "amplifyImg" + picIndex;
							pic = pic + "<div onclick='PicOpen("+picIndex+")' id='" + divId + "' class=\"amplifyImg\"><img style='width: 85px;height: 45px;margin-left: 5px' src=\"" + apiHeader + picStr[j] + "\"/></div>";//<td><a href="javascript:;" onClick="picture_edit('图库编辑','picture-show.html','10001')"><img width="100" class="picture-thumb" src="pic/200x150.jpg"></a></td>
							picIndex = picIndex + 1;
						}
						pic = pic + "</td>";
						mystr = mystr + pic;
						mystr = mystr + "<td>"+dataArray[i].address+"</td>";
						if(dataArray[i].status == 0){
							mystr = mystr + "<td>待审核</td>";
						}else if(dataArray[i].status == 1){
							mystr = mystr + "<td>通过</td>";
						}else{
							mystr = mystr + "<td>不通过</td>";
						}

						//操作
						mystr = mystr + "<td><a onclick='auditShop("+ dataArray[i].id +",1)' style='color: green'>通过</a><a onclick='auditShop("+ dataArray[i].id +",2)' style='color: red;margin-left: 10px'>不通过</a></td>";
					}
					$("#goodTableBody").append(mystr);
					$("#totalNum").text(text.data.total);
				} else {
					layer.error(text.message);
				}
			});
}

//精确
function accMul(arg1, arg2) {
	var m = 0, s1 = arg1.toString(), s2 = arg2.toString();
	try { m += s1.split(".")[1].length } catch (e) { }
	try { m += s2.split(".")[1].length } catch (e) { }
	return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m);
}

//导出
function exportExcel() {
	var name = $("#menuName").val();
	var startTime = $("#logmin").val();
	var endTime = $("#logmax").val();
	var pageSize = $("#pageSizeShow").find("option:selected").val();
	var goodsName = $("#goodsName").val();
	var phone = $("#phone").val();
	var customerName = $("#customerName").val();
	$.post(apiHeader + "/export/exportExcel",{name: name,startTime: startTime,endTime: endTime,page: page,pageSize: pageSize,phone: phone,customerName: customerName,goodsName: goodsName},function (result) {
		if(result.code == 0){
			window.open(apiHeader + "/excel/" + result.data.message +".xls", '_blank');
		}else{
			layer.msg("导出失败");
		}
	})
}
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>